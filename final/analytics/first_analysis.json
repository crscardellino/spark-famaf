{"paragraphs":[{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479578922625_944396309","id":"20161119-190842_1402150266","dateCreated":"2016-11-19T19:08:42+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:151","text":"import java.sql.Timestamp\n\nimport org.apache.spark.sql.{DataFrame, Dataset, SparkSession}\nimport org.apache.spark.sql.expressions.Window\nimport org.apache.spark.sql.functions._\n\nval spark = SparkSession\n  .builder()\n  .appName(\"Spark app\")\n  .config(\"spark.some.config.option\", \"algun-valor\")\n  .getOrCreate()\n\n// Para conversion implicita, por ej entre RDD a DataFrames\nimport spark.implicits._","dateUpdated":"2016-11-19T19:30:33+0100","dateFinished":"2016-11-19T19:30:35+0100","dateStarted":"2016-11-19T19:30:33+0100","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimport java.sql.Timestamp\n\nimport org.apache.spark.sql.{DataFrame, Dataset, SparkSession}\n\nimport org.apache.spark.sql.expressions.Window\n\nimport org.apache.spark.sql.functions._\n\nspark: org.apache.spark.sql.SparkSession = org.apache.spark.sql.SparkSession@f7a7c86\n\nimport spark.implicits._\n"}},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479580233624_-1317476245","id":"20161119-193033_1078033333","dateCreated":"2016-11-19T19:30:33+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:313","dateUpdated":"2016-11-19T20:47:48+0100","dateFinished":"2016-11-19T20:22:46+0100","dateStarted":"2016-11-19T20:22:44+0100","result":{"code":"SUCCESS","type":"TEXT","msg":"\nleyes: org.apache.spark.sql.DataFrame = [id: string, date: string ... 2 more fields]\n\nresultados: org.apache.spark.sql.DataFrame = [id: string, chamber: string ... 2 more fields]\n\nfirmantes: org.apache.spark.sql.DataFrame = [id: string, congressman: string ... 2 more fields]\n\ncomisionesDiputados: org.apache.spark.sql.DataFrame = [id: string, commission: string]\n\nComisionesSenado: org.apache.spark.sql.DataFrame = [id: string, commission: string]\n+-----------+----------+--------------------+--------------------+\n|         id|      date|             summary|            law_text|\n+-----------+----------+--------------------+--------------------+\n|0006-D-2011|2011-03-01|REGIMEN DE AMPARO...| PROYECTO DE LEY ...|\n|0005-D-2011|2011-03-01|MEDIACION PENAL: ...| PROYECTO DE LEY ...|\n|0008-D-2011|2011-03-01|REGIMEN DE INICIA...| PROYECTO DE LEY ...|\n|0007-D-2011|2011-03-01|FACULTAD CONSTITU...| PROYECTO DEL LEY...|\n|0001-D-2011|2011-03-01|CONSEJO DE LA MAG...| PROYECTO DE LEY ...|\n|0002-D-2011|2011-03-01|RATIFICACION DEL ...| PROYECTO DE LEY ...|\n|0011-D-2011|2011-03-01|MODIFICACION DE L...| POYECTO DE LEY S...|\n|0009-D-2011|2011-03-01|INCORPORAR COMO L...| PROYECTO DE LEY ...|\n|0013-D-2011|2011-03-01|ASESOR NAUTICO EN...| ASESOR NAUTICO E...|\n|0010-D-2011|2011-03-01|CODIGO PROCESAL C...| PROYECTO DE LEY ...|\n|0014-D-2011|2011-03-01|TARIFAS DE ENERGI...| Artículo 1º: Der...|\n|0018-D-2011|2011-03-01|DEROGACION DEL PR...| DEROGACION DEL P...|\n|0019-D-2011|2011-03-01|BEBIDAS ENERGIZAN...| Inclusión de las...|\n|0020-D-2011|2011-03-01|CODIGO PROCESAL C...| COBRO DE CUOTAS ...|\n|0022-D-2011|2011-03-01|GARANTIA DEL ACCE...| GARANTÍA DEL ACC...|\n|0023-D-2011|2011-03-01|REGIMEN DE REAJUS...| REAJUSTE AUTOMÁT...|\n|0021-D-2011|2011-03-01|PRORROGA AUTOMATI...| PARA GARANTIZAR ...|\n|0024-D-2011|2011-03-01|CODIGO CIVL: MODI...| REFORMA DEL ART....|\n|0025-D-2011|2011-03-01|CREACION DEL CONS...| CREACIÓN DEL CON...|\n|0031-D-2011|2011-03-01|PRESUPUESTOS MINI...|                    |\n+-----------+----------+--------------------+--------------------+\nonly showing top 20 rows\n\n"},"text":"//Lectura de parquets, cambiar por el directorio que sea necesario.\n\nval leyes = spark.read.parquet(\"/home/lbiedma/Documents/estudiar/bigdata/pruebas/laws.parquet\")\nval resultados = spark.read.parquet(\"/home/lbiedma/Documents/estudiar/bigdata/pruebas/results.parquet\")\nval firmantes = spark.read.parquet(\"/home/lbiedma/Documents/estudiar/bigdata/pruebas/signers.parquet\")\nval comisionesDiputados = spark.read.parquet(\"/home/lbiedma/Documents/estudiar/bigdata/pruebas/deputyCommissions.parquet\")\nval ComisionesSenado = spark.read.parquet(\"/home/lbiedma/Documents/estudiar/bigdata/pruebas/senateCommissions.parquet\")\n\n\nleyes.show()"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479581258710_1573200773","id":"20161119-194738_1933628077","dateCreated":"2016-11-19T19:47:38+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:390","dateUpdated":"2016-11-19T22:08:34+0100","dateFinished":"2016-11-19T22:08:36+0100","dateStarted":"2016-11-19T22:08:34+0100","result":{"code":"SUCCESS","type":"TEXT","msg":"Proyectos por Año:\n\ngetYear: String => String\n+----+-----+\n|Año |count|\n+----+-----+\n|2011|1496 |\n|2012|2188 |\n|2013|1863 |\n|2014|2997 |\n|2015|1983 |\n|2016|2414 |\n+----+-----+\n\nProyectos por Mes:\n\ngetYearMonth: String => String\n+-------+-----+\n|Mes    |count|\n+-------+-----+\n|2011-03|482  |\n|2011-04|143  |\n|2011-05|129  |\n|2011-06|162  |\n|2011-07|94   |\n|2011-08|90   |\n|2011-09|104  |\n|2011-10|87   |\n|2011-11|141  |\n|2011-12|64   |\n|2012-01|3    |\n|2012-02|42   |\n|2012-03|807  |\n|2012-04|194  |\n|2012-05|216  |\n|2012-06|170  |\n|2012-07|96   |\n|2012-08|201  |\n|2012-09|133  |\n|2012-10|140  |\n+-------+-----+\nonly showing top 20 rows\n\nProyectos por Mes del Año:\n\ngetMonth: String => String\n+-----------+-----+\n|Mes del año|count|\n+-----------+-----+\n|01         |8    |\n|02         |144  |\n|03         |3829 |\n|04         |1696 |\n|05         |1295 |\n|06         |982  |\n|07         |684  |\n|08         |1065 |\n|09         |956  |\n|10         |890  |\n|11         |963  |\n|12         |429  |\n+-----------+-----+\n\n"},"text":"//Leyes por día\n//leyes.orderBy(\"date\").groupBy(\"date\").count().show()\n\n//Leyes por año\nprintln(\"Proyectos por Año:\")\ndef getYear: String => String = _.slice(0,4)\nleyes.withColumn(\"Año\", udf(getYear).apply('date)).groupBy(\"Año\").count().orderBy(\"año\").show(false)\n\n//Leyes por mes\nprintln(\"Proyectos por Mes:\")\ndef getYearMonth: String => String = _.dropRight(3)\nleyes.withColumn(\"Mes\", udf(getYearMonth).apply('date)).groupBy(\"Mes\").count().orderBy(\"Mes\").show(false)\n\n//Leyes por mes del año\nprintln(\"Proyectos por Mes del Año:\")\ndef getMonth: String => String = _.slice(5,7)\nleyes.withColumn(\"Mes del año\", udf(getMonth).apply('date)).groupBy(\"Mes del año\").count().orderBy(\"Mes del año\").show(false)"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479581737680_-843906188","id":"20161119-195537_1087168982","dateCreated":"2016-11-19T19:55:37+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:486","dateUpdated":"2016-11-19T22:10:29+0100","dateFinished":"2016-11-19T22:10:31+0100","dateStarted":"2016-11-19T22:10:29+0100","result":{"code":"SUCCESS","type":"TEXT","msg":"\nsancionados: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [id: string, chamber: string ... 2 more fields]\nSancionados por Año:\n+----+-----+\n|Año |count|\n+----+-----+\n|2011|31   |\n|2012|225  |\n|2013|110  |\n|2014|189  |\n|2015|171  |\n|2016|47   |\n+----+-----+\n\nSancionados por Mes:\n+-------+-----+\n|Mes    |count|\n+-------+-----+\n|2011-03|1    |\n|2011-05|1    |\n|2011-06|1    |\n|2011-09|3    |\n|2011-11|14   |\n|2011-12|11   |\n|2012-04|15   |\n|2012-05|5    |\n|2012-06|27   |\n|2012-08|13   |\n|2012-10|36   |\n|2012-11|129  |\n|2013-04|11   |\n|2013-06|15   |\n|2013-07|12   |\n|2013-09|17   |\n|2013-11|54   |\n|2013-12|1    |\n|2014-07|10   |\n|2014-08|19   |\n+-------+-----+\nonly showing top 20 rows\n\nSancionados por Mes del Año:\n+-----------+-----+\n|Mes del año|count|\n+-----------+-----+\n|03         |3    |\n|04         |32   |\n|05         |10   |\n|06         |69   |\n|07         |33   |\n|08         |50   |\n|09         |57   |\n|10         |57   |\n|11         |391  |\n|12         |71   |\n+-----------+-----+\n\n"},"text":"val sancionados = resultados.filter($\"result\".contains(\"MEDIA SANCION\"))\n\n//Sancionados por año\nprintln(\"Sancionados por Año:\")\nsancionados.withColumn(\"Año\", udf(getYear).apply('date)).groupBy(\"Año\").count().orderBy(\"año\").show(false)\n\n//Sancionados por mes\nprintln(\"Sancionados por Mes:\")\nsancionados.withColumn(\"Mes\", udf(getYearMonth).apply('date)).groupBy(\"Mes\").count().orderBy(\"Mes\").show(false)\n\n//Sancionados por mes del año\nprintln(\"Sancionados por Mes del Año:\")\nsancionados.withColumn(\"Mes del año\", udf(getMonth).apply('date)).groupBy(\"Mes del año\").count().orderBy(\"Mes del año\").show(false)\n\n"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479583794778_-1492187075","id":"20161119-202954_202626127","dateCreated":"2016-11-19T20:29:54+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:863","dateUpdated":"2016-11-19T22:23:52+0100","dateFinished":"2016-11-19T22:23:57+0100","dateStarted":"2016-11-19T22:23:52+0100","result":{"code":"SUCCESS","type":"TEXT","msg":"\nmediaSancion: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [id: string, chamber: string ... 2 more fields]\nMedias sanciones por Año:\n+----+------------------+\n|Año |count(DISTINCT id)|\n+----+------------------+\n|2011|31                |\n|2012|210               |\n|2013|110               |\n|2014|186               |\n|2015|171               |\n|2016|45                |\n+----+------------------+\n\nMedias Sanciones por Mes:\n+-------+------------------+\n|Mes    |count(DISTINCT id)|\n+-------+------------------+\n|2011-03|1                 |\n|2011-05|1                 |\n|2011-06|1                 |\n|2011-09|3                 |\n|2011-11|14                |\n|2011-12|11                |\n|2012-04|15                |\n|2012-05|5                 |\n|2012-06|27                |\n|2012-08|13                |\n|2012-10|36                |\n|2012-11|129               |\n|2013-04|11                |\n|2013-06|15                |\n|2013-07|12                |\n|2013-09|17                |\n|2013-11|54                |\n|2013-12|1                 |\n|2014-07|10                |\n|2014-08|19                |\n+-------+------------------+\nonly showing top 20 rows\n\nSancionados por Mes del Año:\n+-----------+------------------+\n|Mes del año|count(DISTINCT id)|\n+-----------+------------------+\n|03         |3                 |\n|04         |32                |\n|05         |10                |\n|06         |69                |\n|07         |33                |\n|08         |50                |\n|09         |57                |\n|10         |57                |\n|11         |387               |\n|12         |71                |\n+-----------+------------------+\n\n"},"text":"val mediaSancion = resultados.filter($\"result\".contains(\"MEDIA SANCION\"))\n\n//Medias sanciones por año\nprintln(\"Medias sanciones por Año:\")\nmediaSancion.withColumn(\"Año\", udf(getYear).apply('date)).groupBy(\"Año\").agg(countDistinct($\"id\")).orderBy(\"Año\").show(false)\n\n//Medias sanciones por mes\nprintln(\"Medias Sanciones por Mes:\")\nmediaSancion.withColumn(\"Mes\", udf(getYearMonth).apply('date)).groupBy(\"Mes\").agg(countDistinct($\"id\")).orderBy(\"Mes\").show(false)\n\n//Sancionados por mes del año\nprintln(\"Sancionados por Mes del Año:\")\nmediaSancion.withColumn(\"Mes del año\", udf(getMonth).apply('date)).groupBy(\"Mes del año\").agg(countDistinct($\"id\")).orderBy(\"Mes del año\").show(false)"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479589567528_-1057405567","id":"20161119-220607_729256170","dateCreated":"2016-11-19T22:06:07+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1162","dateUpdated":"2016-11-19T22:14:16+0100","dateFinished":"2016-11-19T22:14:18+0100","dateStarted":"2016-11-19T22:14:16+0100","result":{"code":"SUCCESS","type":"TEXT","msg":"\nretirados: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [id: string, chamber: string ... 2 more fields]\nRetirados por Año:\n+----+-----+\n|Año |count|\n+----+-----+\n|2011|5    |\n|2012|13   |\n|2013|4    |\n+----+-----+\n\nRetirados por Mes:\n+-------+-----+\n|Mes    |count|\n+-------+-----+\n|2011-11|5    |\n|2012-04|2    |\n|2012-05|1    |\n|2012-06|7    |\n|2012-08|1    |\n|2012-11|2    |\n|2013-03|2    |\n|2013-06|1    |\n|2013-07|1    |\n+-------+-----+\n\nRetirados por Mes del Año:\n+-----------+-----+\n|Mes del año|count|\n+-----------+-----+\n|03         |2    |\n|04         |2    |\n|05         |1    |\n|06         |8    |\n|07         |1    |\n|08         |1    |\n|11         |7    |\n+-----------+-----+\n\n"},"text":"val retirados = resultados.filter($\"result\".contains(\"RETIRADO\"))\n\n//Medias sanciones por año\nprintln(\"Retirados por Año:\")\nretirados.withColumn(\"Año\", udf(getYear).apply('date)).groupBy(\"Año\").count().orderBy(\"Año\").show(false)\n\n//Medias sanciones por mes\nprintln(\"Retirados por Mes:\")\nretirados.withColumn(\"Mes\", udf(getYearMonth).apply('date)).groupBy(\"Mes\").count().orderBy(\"Mes\").show(false)\n\n//Sancionados por mes del año\nprintln(\"Retirados por Mes del Año:\")\nretirados.withColumn(\"Mes del año\", udf(getMonth).apply('date)).groupBy(\"Mes del año\").count().orderBy(\"Mes del año\").show(false)"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479590056203_-940540948","id":"20161119-221416_434910484","dateCreated":"2016-11-19T22:14:16+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1319","dateUpdated":"2016-11-19T22:26:00+0100","dateFinished":"2016-11-19T22:26:02+0100","dateStarted":"2016-11-19T22:26:00+0100","result":{"code":"SUCCESS","type":"TEXT","msg":"+-------------+------------------+\n|       result|count(DISTINCT id)|\n+-------------+------------------+\n|   SANCIONADO|               354|\n|     APROBADO|                 2|\n|     RETIRADO|                22|\n|MEDIA SANCION|               714|\n+-------------+------------------+\n\n+-------------+-----+\n|       result|count|\n+-------------+-----+\n|   SANCIONADO|  354|\n|     APROBADO|    2|\n|     RETIRADO|   22|\n|MEDIA SANCION|  773|\n+-------------+-----+\n\n"},"text":"resultados.groupBy(\"result\").agg(countDistinct($\"id\")).show()\nresultados.groupBy(\"result\").count().show()\n"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479590288337_1625671274","id":"20161119-221808_224031623","dateCreated":"2016-11-19T22:18:08+0100","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1406","dateUpdated":"2016-11-19T22:18:43+0100","text":""}],"name":"HCDN","id":"2C43K64TY","angularObjects":{"2C1MQXXPR:shared_process":[],"2C2SK39AY:shared_process":[],"2C2VMCPCK:shared_process":[],"2C1CV94N5:shared_process":[],"2C2EM31B5:shared_process":[],"2C3CRJU94:shared_process":[],"2C1MWDD4Z:shared_process":[],"2C4X9WTVF:shared_process":[],"2C11MD99T:shared_process":[],"2C2AHWAX3:shared_process":[],"2C1SR6B3P:shared_process":[],"2C2BEDYEA:shared_process":[],"2C13YP3BG:shared_process":[],"2C4NNKJHG:shared_process":[],"2C16U4W7S:shared_process":[],"2C2Y92KWA:shared_process":[],"2C372HDTH:shared_process":[],"2C2KWGF2S:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}