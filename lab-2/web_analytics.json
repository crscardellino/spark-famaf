{"paragraphs":[{"text":"import java.sql.Timestamp\n\nimport org.apache.spark.sql.{DataFrame, Dataset, SparkSession}\nimport org.apache.spark.sql.expressions.Window\nimport org.apache.spark.sql.functions._\n\nval spark = SparkSession\n  .builder()\n  .appName(\"Spark app\")\n  .config(\"spark.some.config.option\", \"algun-valor\")\n  .getOrCreate()\n\n// Para conversion implicita, por ej entre RDD a DataFrames\nimport spark.implicits._","dateUpdated":"2016-11-02T22:59:19-0300","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1478022262558_879619010","id":"20161101-144422_314246459","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimport java.sql.Timestamp\n\nimport org.apache.spark.sql.{DataFrame, Dataset, SparkSession}\n\nimport org.apache.spark.sql.expressions.Window\n\nimport org.apache.spark.sql.functions._\n\nspark: org.apache.spark.sql.SparkSession = org.apache.spark.sql.SparkSession@71c99681\n\nimport spark.implicits._\n"},"dateCreated":"2016-11-01T02:44:22-0300","dateStarted":"2016-11-02T22:59:19-0300","dateFinished":"2016-11-02T22:59:42-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:103","focus":true},{"text":"case class HitsDataset(timestamp: String, userid: String, event: String, amount: Double)\n\ncase class SessionsDataset(userid: String, start: String, end: String,\n                           renders: Int, plays: Int, checkouts: Int, amount: Double)\n\nval hitsDataset = spark.read.parquet(\"grupo04/lab-2/parquets/hitsDataset.parquet\").as[HitsDataset]\nval sessionsDataset = spark.read.parquet(\"grupo04/lab-2/parquets/sessionsDataset.parquet\").as[SessionsDataset]","dateUpdated":"2016-11-02T22:59:21-0300","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1478022361840_591981719","id":"20161101-144601_894267582","result":{"code":"SUCCESS","type":"TEXT","msg":"\ndefined class HitsDataset\n\ndefined class SessionsDataset\n\nhitsDataset: org.apache.spark.sql.Dataset[HitsDataset] = [timestamp: string, userid: string ... 2 more fields]\n\nsessionsDataset: org.apache.spark.sql.Dataset[SessionsDataset] = [userid: string, start: string ... 5 more fields]\n"},"dateCreated":"2016-11-01T02:46:01-0300","dateStarted":"2016-11-02T22:59:22-0300","dateFinished":"2016-11-02T22:59:54-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:104","focus":true},{"text":"def toLocalDate: String => String = _.split(\"\\\\s+\")(0)\n\nhitsDataset.withColumn(\"date\", udf(toLocalDate).apply('timestamp)).groupBy('date.as(\"Dia\")).agg(countDistinct('userid).as(\"Numero de usuarios por dia\")).show(false)","dateUpdated":"2016-11-02T22:59:25-0300","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1478027288133_1797709493","id":"20161101-160808_342876415","result":{"code":"SUCCESS","type":"TEXT","msg":"\ntoLocalDate: String => String\n+----------+--------------------------+\n|Dia       |Numero de usuarios por dia|\n+----------+--------------------------+\n|2016-08-02|641974                    |\n|2016-08-03|652827                    |\n+----------+--------------------------+\n\n"},"dateCreated":"2016-11-01T04:08:08-0300","dateStarted":"2016-11-02T22:59:43-0300","dateFinished":"2016-11-02T23:00:21-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:105","focus":true},{"text":"def toLocalDate: String => String = _.split(\"\\\\s+\")(0)\n\nsessionsDataset.withColumn(\"sessionDate\", udf(toLocalDate).apply('start)).groupBy('sessionDate, 'userid).agg(count('userid).as(\"sessionsPerDay\")).filter(\"sessionsPerDay > 1\").groupBy('sessionDate.as(\"Dia\")).agg(count('sessionsPerDay).as(\"Numero de usuarios que retornan por dia\")).show(false)","dateUpdated":"2016-11-02T22:59:26-0300","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1478036035565_-445509653","id":"20161101-183355_133593574","result":{"code":"SUCCESS","type":"TEXT","msg":"\ntoLocalDate: String => String\n+----------+---------------------------------------+\n|Dia       |Numero de usuarios que retornan por dia|\n+----------+---------------------------------------+\n|2016-08-02|65220                                  |\n|2016-08-03|63378                                  |\n+----------+---------------------------------------+\n\n"},"dateCreated":"2016-11-01T06:33:55-0300","dateStarted":"2016-11-02T22:59:55-0300","dateFinished":"2016-11-02T23:00:50-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:106","focus":true},{"text":"def toMinutes: String => Long = Timestamp.valueOf(_).getTime / 60000L\n\nsessionsDataset.withColumn(\"duration\", udf(toMinutes).apply('end) - udf(toMinutes).apply('start))\n    .select(avg('duration).as(\"Promedio de duracion de sesion (en minutos)\")).show(false)","dateUpdated":"2016-11-02T22:59:28-0300","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1478028586447_1352236497","id":"20161101-162946_1188274656","result":{"code":"SUCCESS","type":"TEXT","msg":"\ntoMinutes: String => Long\n+-------------------------------------------+\n|Promedio de duracion de sesion (en minutos)|\n+-------------------------------------------+\n|4.359304104385711                          |\n+-------------------------------------------+\n\n"},"dateCreated":"2016-11-01T04:29:46-0300","dateStarted":"2016-11-02T23:00:22-0300","dateFinished":"2016-11-02T23:00:55-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:107","focus":true},{"text":"val rowMaxOverTwo = sessionsDataset.count.toFloat / 2\n\nsessionsDataset.select($\"renders\", row_number.over(Window.orderBy($\"renders\")).as(\"rowIndex\"))\n    .select($\"renders\", $\"rowIndex\", ($\"rowIndex\" - rowMaxOverTwo).as(\"filterRow\")).where($\"filterRow\" >= 0 && $\"filterRow\" <= 1)\n    .agg(avg($\"renders\").as(\"Mediana de renders por sesion\")).show(false)\n    \nsessionsDataset.select($\"plays\", row_number.over(Window.orderBy($\"plays\")).as(\"rowIndex\"))\n    .select($\"plays\", $\"rowIndex\", ($\"rowIndex\" - rowMaxOverTwo).as(\"filterRow\")).where($\"filterRow\" >= 0 && $\"filterRow\" <= 1)\n    .agg(avg($\"plays\").as(\"Mediana de plays por sesion\")).show(false)\n    \nsessionsDataset.select($\"checkouts\", row_number.over(Window.orderBy($\"checkouts\")).as(\"rowIndex\"))\n    .select($\"checkouts\", $\"rowIndex\", ($\"rowIndex\" - rowMaxOverTwo).as(\"filterRow\")).where($\"filterRow\" >= 0 && $\"filterRow\" <= 1)\n    .agg(avg($\"checkouts\").as(\"Mediana de checkouts por sesion\")).show(false)","dateUpdated":"2016-11-02T22:59:30-0300","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1478116389627_1125227487","id":"20161102-165309_2011356603","result":{"code":"SUCCESS","type":"TEXT","msg":"\nrowMaxOverTwo: Float = 730828.0\n+-----------------------------+\n|Mediana de renders por sesion|\n+-----------------------------+\n|1.0                          |\n+-----------------------------+\n\n+---------------------------+\n|Mediana de plays por sesion|\n+---------------------------+\n|0.0                        |\n+---------------------------+\n\n+-------------------------------+\n|Mediana de checkouts por sesion|\n+-------------------------------+\n|0.0                            |\n+-------------------------------+\n\n"},"dateCreated":"2016-11-02T04:53:09-0300","dateStarted":"2016-11-02T23:00:51-0300","dateFinished":"2016-11-02T23:01:03-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:108","focus":true},{"text":"def toLocalDate: String => String = _.split(\"\\\\s+\")(0)\ndef toHour: String => String = _.split(\"\\\\s+\")(1).split(\":\")(0)\n\nsessionsDataset.select($\"userid\", udf(toLocalDate).apply($\"start\").as(\"Dia\"), udf(toHour).apply($\"start\").as(\"Hora\")).groupBy(\"Dia\", \"Hora\")\n    .agg(count($\"userid\").as(\"Cantidad de visitas por dia por hora\")).orderBy(\"Dia\", \"Hora\").show(48, false)","dateUpdated":"2016-11-02T22:59:33-0300","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1478119523362_-376185912","id":"20161102-174523_1443783904","result":{"code":"SUCCESS","type":"TEXT","msg":"\ntoLocalDate: String => String\n\ntoHour: String => String\n+----------+----+------------------------------------+\n|Dia       |Hora|Cantidad de visitas por dia por hora|\n+----------+----+------------------------------------+\n|2016-08-02|00  |48693                               |\n|2016-08-02|01  |49685                               |\n|2016-08-02|02  |47892                               |\n|2016-08-02|03  |39988                               |\n|2016-08-02|04  |29430                               |\n|2016-08-02|05  |21356                               |\n|2016-08-02|06  |13823                               |\n|2016-08-02|07  |8971                                |\n|2016-08-02|08  |6676                                |\n|2016-08-02|09  |6802                                |\n|2016-08-02|10  |9914                                |\n|2016-08-02|11  |15751                               |\n|2016-08-02|12  |24906                               |\n|2016-08-02|13  |33648                               |\n|2016-08-02|14  |37638                               |\n|2016-08-02|15  |37393                               |\n|2016-08-02|16  |37058                               |\n|2016-08-02|17  |37179                               |\n|2016-08-02|18  |37549                               |\n|2016-08-02|19  |36997                               |\n|2016-08-02|20  |37580                               |\n|2016-08-02|21  |35868                               |\n|2016-08-02|22  |35426                               |\n|2016-08-02|23  |37886                               |\n|2016-08-03|00  |42800                               |\n|2016-08-03|01  |47299                               |\n|2016-08-03|02  |46431                               |\n|2016-08-03|03  |38770                               |\n|2016-08-03|04  |29372                               |\n|2016-08-03|05  |20944                               |\n|2016-08-03|06  |13765                               |\n|2016-08-03|07  |9191                                |\n|2016-08-03|08  |6934                                |\n|2016-08-03|09  |6922                                |\n|2016-08-03|10  |10081                               |\n|2016-08-03|11  |16626                               |\n|2016-08-03|12  |29809                               |\n|2016-08-03|13  |34533                               |\n|2016-08-03|14  |37293                               |\n|2016-08-03|15  |37938                               |\n|2016-08-03|16  |38393                               |\n|2016-08-03|17  |37632                               |\n|2016-08-03|18  |37897                               |\n|2016-08-03|19  |37647                               |\n|2016-08-03|20  |38139                               |\n|2016-08-03|21  |38173                               |\n|2016-08-03|22  |38284                               |\n|2016-08-03|23  |38674                               |\n+----------+----+------------------------------------+\n\n"},"dateCreated":"2016-11-02T05:45:23-0300","dateStarted":"2016-11-02T23:00:55-0300","dateFinished":"2016-11-02T23:01:15-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:109","focus":true},{"text":"sessionsDataset.select(avg(\"amount\").as(\"Promedio del monto del checkout por sesion\")).show(false)","dateUpdated":"2016-11-02T22:59:36-0300","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1478023835238_532917862","id":"20161101-151035_13870949","result":{"code":"SUCCESS","type":"TEXT","msg":"+------------------------------------------+\n|Promedio del monto del checkout por sesion|\n+------------------------------------------+\n|224.2794189636145                         |\n+------------------------------------------+\n\n"},"dateCreated":"2016-11-01T03:10:35-0300","dateStarted":"2016-11-02T23:01:04-0300","dateFinished":"2016-11-02T23:01:17-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:110","focus":true},{"text":"val eventsIds = Map(\n    \"12c6fc06c99a462375eeb3f43dfd832b08ca9e17\" -> \"R\",\n    \"bd307a3ec329e10a2cff8fb87480823da114f8f4\" -> \"P\",\n    \"7b52009b64fd0a2a49e6d8a939753077792b0554\" -> \"C\"\n).withDefaultValue(\"\")\n\ndef toLocalDate: String => String = _.split(\"\\\\s+\")(0)\ndef toTimestamp: String => Long = Timestamp.valueOf(_).getTime\ndef toEvent: String => String = eventsIds(_)\ndef toConcatenation: scala.collection.mutable.WrappedArray[String] => String = _.toArray.mkString(\"\")\n\nval convertedDataset = hitsDataset.select(\n    udf(toLocalDate).apply($\"timestamp\").as(\"date\"),\n    udf(toTimestamp).apply($\"timestamp\").as(\"timestamp\"),\n    $\"userid\", udf(toEvent).apply($\"event\").as(\"event\"))\n\nval numberOfGoalAchievements = convertedDataset\n    .orderBy($\"timestamp\").groupBy($\"userid\", $\"date\").agg(collect_list($\"event\").as(\"events\"))\n    .select($\"userid\", $\"date\", udf(toConcatenation).apply($\"events\").as(\"events\")).filter($\"events\" rlike \".*R.*P.*C.*\").count\n\nval visitors = convertedDataset.groupBy($\"date\").agg(countDistinct($\"userid\").as(\"visitorsPerDay\")).select(sum($\"visitorsPerDay\")).as[(Double)].head()\n\nval conversionRate = numberOfGoalAchievements.toDouble / visitors\n\nprintln($\"Conversion rate: $conversionRate\")","dateUpdated":"2016-11-02T23:01:26-0300","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1478033880216_1251774276","id":"20161101-175800_119529390","result":{"code":"SUCCESS","type":"TEXT","msg":"\neventsIds: scala.collection.immutable.Map[String,String] = Map(12c6fc06c99a462375eeb3f43dfd832b08ca9e17 -> R, bd307a3ec329e10a2cff8fb87480823da114f8f4 -> P, 7b52009b64fd0a2a49e6d8a939753077792b0554 -> C)\n\ntoLocalDate: String => String\n\ntoTimestamp: String => Long\n\ntoEvent: String => String\n\ntoConcatenation: scala.collection.mutable.WrappedArray[String] => String\n\nconvertedDataset: org.apache.spark.sql.DataFrame = [date: string, timestamp: bigint ... 2 more fields]\n\nnumberOfGoalAchievements: Long = 133\n\nvisitors: Double = 1294801.0\n\nconversionRate: Double = 1.0271848724244111E-4\nConversion rate: 1.0271848724244111E-4\n"},"dateCreated":"2016-11-01T05:58:00-0300","dateStarted":"2016-11-02T23:01:26-0300","dateFinished":"2016-11-02T23:05:24-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:111","focus":true},{"text":"","dateUpdated":"2016-11-02T10:44:50-0300","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1478122818003_-1738513369","id":"20161102-184018_2060698443","dateCreated":"2016-11-02T06:40:18-0300","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:112"}],"name":"Laboratorio 2 - Web Analytics","id":"2BZ6DMH6H","angularObjects":{"2C2XT33G1:shared_process":[],"2C263UDKK:shared_process":[],"2BZQP7FP2:shared_process":[],"2C23FW81F:shared_process":[],"2C3EE4HU4:shared_process":[],"2C2KKEMWN:shared_process":[],"2BYT7ENXJ:shared_process":[],"2BYZMUBD9:shared_process":[],"2C1HD5GBB:shared_process":[],"2C31H66JG:shared_process":[],"2C1DFBGKY:shared_process":[],"2C1T2FY1C:shared_process":[],"2C1TS1PZ4:shared_process":[],"2C1ZVKWTZ:shared_process":[],"2C383Y25P:shared_process":[],"2C2MXESVD:shared_process":[],"2BZ93H6EZ:shared_process":[],"2BYN16RU5:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}